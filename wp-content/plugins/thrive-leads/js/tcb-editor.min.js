/*! Thrive Leads - The ultimate Lead Capture solution for wordpress - 2018-01-24
* https://thrivethemes.com 
* Copyright (c) 2018 * Thrive Themes */

var TL_Editor=TL_Editor||{},TCB_AnimViews=TVE.Views.Components.AnimationViews;TL_Editor.views=TL_Editor.views||{},TL_Editor.views.components=TL_Editor.views.components||{},TL_Editor.views.ShortcodesPanel=TVE.Views.InlinePanel.extend({template:TVE.tpl("inline/content-templates"),after_initialize:function(){this.$(".drop-panel").addClass("small-pad tcb-autocomplete"),this.autocomplete()},autocomplete:function(){var a=this;this.$input=this.$(".tcb-search").autocomplete({minLength:0,appendTo:this.$(".popup-content"),source:function(a,b){b(jQuery.ui.autocomplete.filter(TVE.CONST.tl_shortcodes,a.term).slice(0,5))},select:function(b,c){return a.render_html(c.item.id),b.stopPropagation(),!1}}),this.$input.data("ui-autocomplete")._renderItem=function(a,b){a.addClass("tcb-suggest");var c=new RegExp(this.term,"i");return jQuery("<li></li>").data("item.autocomplete",b).append('<a href="#" class="tcb-truncate">'+b.label.replace(c,'<span class="highlight">'+this.term+"</span>")+"</a>").appendTo(a)}},render_html:function(a){var b={shortcode_id:a,external_action:"render_tl_shortcode"};TVE.ActiveElement.addClass("tcb-el-loading"),TVE.ajax("save_post_external","post",b,"json").done(function(a){var b=TVE.drag.insert(a.html,TVE.ActiveElement,!1,!0);TVE.Editor_Page.focus_element(b),TVE.ActiveElement.removeClass("tcb-el-loading")})},onOpen:function(){this.$input.val("").focus().autocomplete("search")}}),TVE.Views.Components.tl_shortcode=TVE.Views.Base.component.extend({before_update:function(){var a=TVE.ActiveElement.find(".tve-leads-conversion-object").data("tl-type"),b=null;a&&(b=parseInt(a.replace("shortcode_",""))),this.list.set_value(b)},controls_init:function(){var a=this;this.placeholder_panel=new TL_Editor.views.ShortcodesPanel({component:this,minWidth:300,no_buttons:!0}),this.list=new TVE.Views.Controls.List({el:this.$("#tl_shortcodes_list")[0],items:TVE.CONST.tl_shortcodes}),this.list.on("change",function(b){a.placeholder_panel.render_html(b)})},placeholder_action:function(){this.placeholder_panel.open(TVE.ActiveElement,TVE.ActiveElement.find(".tcb-inline-placeholder-action"))}}),TL_Editor.views.ThriveBoxAction=TCB_AnimViews.ThriveLightbox.extend({controls_init:function(){this.list=new TVE.Views.Controls.List({el:this.$(".state-list")[0],items:this.options.actions[this.key].options}),this.event_trigger="click",this.$animation=this.$("#lb-animation").hide()},apply_settings:function(a){return!!this.validate()&&(this.model.set({a:this.key,t:this.parent_tab.$("#a-popup-trigger").val(),config:{l_id:this.list.get_value()}}),!0)}}),function(a){function b(){var b=this,c=this.model.get("asset_delivery");if(1===parseInt(c._asset_option))return a.each(c,function(a,c){var d=b.$("#"+a);if(d.length>0)d.val(c);else{var e=b._write.renderHiddenInput({name:a,value:c});b.get_wrapper("form").append(e)}}),this;this.$("input[name*='asset']").remove()}function c(){var b={};return this.$("input[name*='asset']").each(function(){b[this.getAttribute("name")]=this.value}),this.model.set("asset_delivery",a.extend({_asset_group:0,_asset_option:0},b)),b}TVE.Views.Controls.AssetDelivery=TVE.Views.Controls.Checkbox.extend({before_initialize:function(){TVE.add_filter("lg_api_save",this.update.bind(this)),TVE.add_filter("lg_custom_html_save",this.update.bind(this))},update:function(){var a=this.component;void 0===a.leadGenerationView._read.asset_delivery&&(a.leadGenerationView._read.asset_delivery=c),a.leadGenerationView.read("asset_delivery");var b=a.leadGenerationModel.get("asset_delivery")._asset_option;this.setChecked(b),this.$el.parent().find("#tve-leads-asset-controls").toggleClass("tcb-hidden",!b)},input:function(a,c){var d=this.component;void 0===d.leadGenerationView._write.asset_delivery&&(d.leadGenerationView._write.asset_delivery=b);var e=d.leadGenerationModel.get("asset_delivery");e=jQuery.extend(e,{_asset_option:c.checked?1:0}),this.$el.parent().find("#tve-leads-asset-controls").toggleClass("tcb-hidden",!c.checked),d.leadGenerationModel.set("asset_delivery",e),d.leadGenerationView.write("asset_delivery")}}),TVE.Views.Controls.AssetGroup=TVE.Views.Controls.Select.extend({update:function(){var a=this.component,c=a.leadGenerationModel.get("asset_delivery")._asset_group;void 0===a.leadGenerationView._write.asset_delivery&&(a.leadGenerationView._write.asset_delivery=b),0===c&&(c=this.$select.find("option").first().val(),a.leadGenerationModel.get("asset_delivery")._asset_group=c,a.leadGenerationView.write("asset_delivery")),this.setValue(c)},input:function(a,b){var c=this.component,d=c.leadGenerationModel.get("asset_delivery");d._asset_group=b.value,c.leadGenerationModel.set({asset_delivery:d,write:"asset_delivery"})}}),a(function(){TVE.add_filter("tcb_page_event_actions",function(a,b){var c=b.extend({template:TVE.tpl("page-events/thrive-box"),get:function(){return TVE.Components.animation.options.actions.thrive_leads_2_step.options}});return delete a.thrive_leads_2_step.disabled,a.thrive_leads_2_step.view=new c,a}),TVE.add_filter("tve_custom_html_code",function(b){if("undefined"!=typeof tve_leads_page_data){var c={group_id:tve_leads_page_data.group_id,form_type_id:tve_leads_page_data.post_id,variation_id:tve_leads_page_data._key};a("<div>",{html:"__CONFIG_tve_leads_additional_fields_filters__"+JSON.stringify(c)+"__CONFIG_tve_leads_additional_fields_filters__"}).hide().appendTo(b)}})})}(jQuery);