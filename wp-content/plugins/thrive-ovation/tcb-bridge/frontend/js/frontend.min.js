/*! Thrive Ovation - 2017-12-13
* http://www.thrivethemes.com/
* Copyright (c) 2017 Thrive Themes */

TVO_Shortcode=function(a){var b={id:TVO_Front.shortcode_id,template:"",$element:a,config:{},menu:{},templates_modal:jQuery("#tvo-testimonial-templates"),save_notification_timeout:null};return b.route=function(a){return void 0===a&&(a=""),TVO_Front.routes.shortcodes+a+"/"+b.id},b._bind=function(a){b.menu=a;var c=b.templates_modal.find(".tvo-save-template");a.find(".tvo_menu_item").each(function(){var a=jQuery(this);a.on("click",b[a.data("func")])}),a.find(".tvo_config_field").on("click",function(){b.config=b.getFormData(a,b.config),b.save()}),jQuery(document).on("click",".tvo-template ",b.template_select),jQuery(document).on("tvo_event",function(a,c,d){"function"==typeof b[c]?b[c](d):b[c]=d}),b.simple_bind(c,jQuery.proxy(b.save_template,b)),b.load(b.init)},b.displayMessage=function(a,b,c){var d=jQuery("#tvo_notification_box").show(0);d.length||(d=jQuery('<div id="tvo_notification_box"></div>').appendTo("body")),-1===b?d.addClass("tvo_warning_box"):b?d.addClass("tvo_error_box"):d.removeClass("tvo_error_box tve_warning_box"),void 0===c&&(c=2e3),-1===b?d.html(a):d.text(a),d.animate({left:100},700),setTimeout(function(){d.animate({left:-950},700)},c)},b.displayWarning=function(){var a=this;this.save_notification_timeout=setInterval(function(){a.displayMessage('<div class="tvo-f-icon-close"></div><p><strong>Reminder</strong></p><br/><p>You have not saved your work for 10 minutes.</p><p>We recommend you perform a save to make sure you don\'t lose any work !</p></br><a id="tvo-stop-saving-warning" style="display: block; text-align: right" href="javascript:void(0)">Stop reminding me for this work only !</a>',-1,6e3),jQuery("#tvo-stop-saving-warning").click(function(){jQuery("#tvo_notification_box").fadeOut(200),a.cancelWarning()}),jQuery("#tvo_notification_box .tvo-f-icon-close").click(function(){jQuery(this).parent().fadeOut(200)})},6e5)},b.cancelWarning=function(){clearInterval(this.save_notification_timeout),this.save_notification_timeout=null},b.save_config=function(a){b.config=jQuery.extend({},b.config,a)},b.save_template=function(){b.template=b.templates_modal.find(".tvo-template.current").data("value"),b.save(),window.setTimeout(function(){window.opener.postMessage({event:"tvo_testimonials_template_update",template:b.template},"*")},1e3)},b.simple_bind=function(a,c,d){void 0===d&&(d="click"),a instanceof jQuery||(a=b.$element.find(a)),a.on(d,jQuery.proxy(c,b))},b.setConfig=function(a,c){b.config[a]=c},b.getFormData=function(a,b){var c={};return void 0!==b&&(c=b),a.find(".tvo_config_field").each(function(){c[this.name]="checkbox"===this.type?this.checked?1:0:this.value}),c},b.setFormData=function(a,c){void 0===c&&(c=b.config),a.find(".tvo_config_field").each(function(){"checkbox"===this.type?this.checked=1===parseInt(c[this.name]):this.value=c[this.name]||""})},b.save=function(a){0!==b.template.length&&(window.onbeforeunload=null,b.config=b.getFormData(b.menu,b.config),b.setConfig("template",b.template),TVO_Front.preloader.show(),jQuery.ajax({headers:{"X-WP-Nonce":TVO_Front.nonce},cache:!1,data:{config:b.config},method:"POST",url:b.route()}).done(function(c){b.load(),b.displayMessage("All changes saved!"),"function"==typeof a&&a(),void 0!==b.activeModal&&b.activeModal.closeModal()}).fail(function(a){console.error(a)}))},b.load=function(a){b.setConfig("template",b.template),TVO_Front.preloader.show(),jQuery.ajax({headers:{"X-WP-Nonce":TVO_Front.nonce},cache:!1,method:"GET",url:b.route("/frontend")}).done(function(c){b.config=c.config,b.template=c.config.template,b.$element.css("opacity","0.05"),b.$element.html(c.template),setTimeout(function(){b.$element.css("opacity","1"),TVO_Front.preloader.hide()},700),TVO_Front.active_config=c.config,"function"==typeof a&&a()}),b.cancelWarning(),b.displayWarning()},b.template_select=function(){this.parentNode.childNodes.forEach(function(a){a.nodeType!==Node.TEXT_NODE&&a.classList.remove("current")}),this.classList.add("current")},b.toggle_fields=function(){var a=jQuery(this).data("toggle");jQuery(a).toggle()},b.openModal=function(a){b.activeModal=b[a],b.activeModal.openModal()},b.closeModal=function(a){!a.length&&this.activeModal&&(a="activeModal"),b[a].closeModal()},b.init=function(){},b.preselectTemplate=function(a){a.find(".tvo-template").each(function(){this.dataset.value===b.template?this.classList.add("current"):this.classList.remove("current")})},b},jQuery.fn.extend({tvo_capture_form:function(){var a=TVO_Shortcode(jQuery(this));a.settings_modal=jQuery("#tvo-form-settings"),a.form_settings=function(){a.openModal("settings_modal"),a.setFormData(a.settings_modal),a.settings_modal.find(".tvo-all-tags").val(a.config.tags).trigger("change"),a.settings_modal.find(".tvo-question").remove(),a.config.questions.forEach(function(b,c){jQuery("<div>",{class:"tvo-row tvo-collapse tvo-question"+(0===c?" tvo-default-question":""),html:TVO_Front.tpl("new-question")({index:c,question:b,config:a.config})}).insertBefore(".tvo-add-question")})},a.change_template=function(){a.openModal("templates_modal"),a.preselectTemplate(a.templates_modal)};var b=a.settings_modal.find(".tve_editor_button ");return a.simple_bind(b,function(){a.config=a.getFormData(a.settings_modal,a.config),a.config.questions=[],a.config.placeholders=[],a.config.questions_required=[],a.settings_modal.find(".tvo-question").each(function(b){var c=jQuery(this);a.config.questions[b]=c.find(".tvo-question-input").val(),a.config.placeholders[b]=c.find(".tvo-placeholder-input").val(),a.config.questions_required[b]=c.find(".tvo-required").is(":checked")?1:0}),a.config.tags=a.settings_modal.find(".tvo-all-tags").val(),a.save()},"click"),a.init=function(){a.template=a.config.template,a.simple_bind(a.menu.find(".tvo_template_colors li"),function(b){var c=jQuery(b.currentTarget).attr("class"),d=a.$element.find(".tvo_testimonial_form");window.onbeforeunload=function(){return!0},a.setConfig("color_class",c),d.attr("class",d.attr("class").replace(/tve_(\w+)/i,c))}),jQuery(document).mouseup(function(b){var c=a.menu.find(".tvo_toggle_fields_box");c.is(b.target)||0!==c.has(b.target).length||c.hide()}),a.template.length||a.openModal("templates_modal")},a},tvo_display_testimonials:function(){var a=TVO_Shortcode(jQuery(this)),b=function(){Backbone.history.stop(),Backbone.history.start(),void 0===TVO_Front.active_config||0===TVO_Front.active_config.testimonials.length&&0===TVO_Front.active_config.tags.length?TVO_Front.router.navigate("#start",{trigger:!0}):TVO_Front.router.navigate("#pre-select",{trigger:!0}),TVO_Front.active_element=jQuery("#tvo_display_shortcode")};return a.settings_modal=jQuery("#tvo-display-testimonials"),a.display_settings=function(){a.openModal("settings_modal"),b()},a.change_template=function(){a.template_select="update",a.openModal("templates_modal"),a.preselectTemplate(a.templates_modal)},a.init=function(){a.menu.find(".tvo_toggle_fields_box").find("input").each(function(){var b=jQuery(this),c="0"!=a.config[b.attr("name")];b.prop("checked",c)}),jQuery(document).mouseup(function(b){var c=a.menu.find(".tvo_toggle_fields_box");c.is(b.target)||0!==c.has(b.target).length||c.hide()}),a.menu.find("#show_role").is(":checked")||a.menu.find("#show_site").prop("disabled",!0),a.menu.find("#show_role").click(function(){var b=a.menu.find("#show_site");jQuery(this).is(":checked")?b.prop("disabled",!1):b.prop("disabled",!0)}),a.simple_bind(a.menu.find(".tvo_template_colors li"),function(b){var c=jQuery(b.currentTarget).attr("class"),d=a.$element.find(".tvo-testimonials-display");window.onbeforeunload=function(){return!0},a.setConfig("color_class",c),d.attr("class",d.attr("class").replace(/tve_(\w+)/i,c))}),0===a.config.tags.length&&0===a.config.testimonials.length&&(a.template_select="init",a.openModal("templates_modal"),a.activeModal.find(".tvo_select_template").val("Continue"))},a.save_template=function(){a.template=a.templates_modal.find(".tvo-template.current").data("value"),"init"===a.template_select?(a.activeModal.closeModal(),a.openModal("settings_modal"),b()):a.save()},a}});var TVO_Front=TVO_Front||{};TVO_Front.preloader={spinner:jQuery("#tvd-hide-onload"),show:function(){this.spinner.show()},hide:function(){var a=this.spinner;setTimeout(function(){a.fadeOut(100)},200)}},function(a){function b(b){var c=a("#wpadminbar"),d=a("body");c.length&&(b.css("top",c.outerHeight()),d.css("margin-top",parseInt(d.css("margin-top"))+parseInt(b.outerHeight())))}a(function(){window.onbeforeunload=null;var c=a("#tvo-preview-menu"),d=a("#tvo_capture_shortcode"),e=a("#tvo_display_shortcode");if(d.length>0)d.tvo_capture_form()._bind(c);else if(e.length>0){var f=e.tvo_display_testimonials();f._bind(c)}b(c),a(document).on("tvo.get.shortcode",function(a,b){f.save_config(b),f.save()}),a(document).on("tvo.save.shortcode",function(b,c){f.save_config(c);var d={name:f.config.name,type:"display",config:f.config,content:""};a.ajax({headers:{"X-WP-Nonce":TVO_Front.nonce},cache:!1,url:TVO_Front.routes.shortcodes,type:"POST",data:d}).done(f.save)})}),a("body").on("click",".tve_scT > ul li",function(b){var c=a(this),d=c.parents(".tve_scT").first(),e=d.find(".tve_scTC").eq(c.index());d.find(".tve_tS").removeClass("tve_tS"),c.addClass("tve_tS"),d.find(".tve_scTC").hide(),e.show(),b.preventDefault()})}(jQuery);